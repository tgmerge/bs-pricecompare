## Server side

### database

* Updates(*q*, time)
* Items(*id*, site, url, price, img, title, q)
* Sessions(*sid*, data)

### process

	query(q, site, sid, page)
		if A = findtuple(Sessions, sid=sid) == None:
			if B = findtuple(Items, (q in title or q in q) and (site=site)) == None:
				fetch and parse from websites for a limited time
				write parse result to Items
				B = findtuple(Items, (q in title or q in q) and (site=site))
			write(Sessions, data from B)
		return data from Sessions from A {q, site, sid, page, [{site, img, url, price, title}, ...]

	queryupdate(q)
		findtuple(Updates, q=q)
		return JSON(time)

## Client side

### ajax and json transfer

[C]-->[S.searchUrl]

* q: query keyword
* site: site name, can be 'all', 'amazon', etc
* session: random session id
* page: new page we're jumping to

[C]<--[S.searchUrl]

* q
* site
* session
* page
* count: total number of returned items
* updateTime: server side update time of query 'q'
* totalPage: we have at most this number of pages
* items: [{img, price, site, url, title}, ...] list of actual items

- - -

[C]-->[S.updateUrl]

* q: query keyword

[C]<--[S.updateUrl]

* q
* updateTime: server side update time of query 'q'